<div class="change-password-card">
  <mat-card class="mat-elevation-z0 change-password-body">

    <mat-card-title class="change-password-title">Change Password</mat-card-title>

    <ng-container>
      <form #changePasswordForm="ngForm">
        <mat-form-field appearance="outline" class="change-password-form-field">
          <input
            matInput
            class="change-password-form-input"
            [type]="hideCurrentPassword ? 'password' : 'text'"
            ngModel
            name="currentPassword"
            required
            #currentPassword="ngModel"
            placeholder="Current Password"
          />

          <button
            mat-icon-button
            matSuffix
            (click)="hideCurrentPassword = !hideCurrentPassword"
            [attr.aria-label]="'Hide password'"
            [attr.aria-pressed]="hideCurrentPassword"
          >
            <mat-icon>{{
              hideCurrentPassword ? "visibility_off" : "visibility"
            }}</mat-icon>
          </button>

          <mat-error *ngIf="currentPassword.invalid"
            >Please enter your current password.</mat-error
          >
        </mat-form-field>

        <br>

        <mat-form-field appearance="outline" class="change-password-form-field">
          <input
            matInput
            class="change-password-form-input"
            [type]="hideNewPassword ? 'password' : 'text'"
            ngModel
            name="newPassword"
            required
            #newPassword="ngModel"
            placeholder="New Password"
          />

          <button
            mat-icon-button
            matSuffix
            (click)="hideNewPassword = !hideNewPassword"
            [attr.aria-label]="'Hide password'"
            [attr.aria-pressed]="hideNewPassword"
          >
            <mat-icon>{{
              hideNewPassword ? "visibility_off" : "visibility"
            }}</mat-icon>
          </button>

          <mat-error *ngIf="newPassword.invalid"
            >Please provide us with your new password.</mat-error
          >
        </mat-form-field>

        <mat-card-footer class="change-password-footer">
          <button
            class="btn btn-outline-primary mb-2 mr-2 change-password-button"
            (click)="onChangePassword(changePasswordForm)"
          >
            Request password change
          </button>
        </mat-card-footer>
      </form>
    </ng-container>
  </mat-card>
</div>

<div class="change-password-card">
  <mat-card class="mat-elevation-z0 change-password-body">
    <mat-card-title class="download-csv-title">
      CSV File download
    </mat-card-title>

    <mat-card-subtitle>
      click on the button below
    </mat-card-subtitle>


    <form #csvDateFilterForm="ngForm">
      <mat-form-field appearance="outline">
        <mat-label>Choose a start date</mat-label>
        <input
        matInput
        [matDatepicker]="startDatePicker"
        placeholder="Start date"
        ngModel
        #startDate="ngModel"
        name="startDate"
        >
        <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #startDatePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Choose an end date</mat-label>
        <input matInput
        [matDatepicker]="endDatePicker"
        placeholder="End date"
            ngModel
            #endDate="ngModel"
            name="endDate">
        <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #endDatePicker></mat-datepicker>
      </mat-form-field>
    </form>
    <mat-card-footer>
      <button
      class="btn btn-outline-primary mb-2 mr-2 change-password-button"
      (click)="onDownloadCSV(csvDateFilterForm)"
    >
      Download CSV
    </button>
    </mat-card-footer>
  </mat-card>
</div>

<div
  *ngIf="requestedNewPassword"
  class="alert alert-success alert-dismissible fade show"
  role="alert"
>
  <strong>Password changed!</strong>
  <button
    (click)="closeNotification()"
    type="button"
    class="close"
    data-dismiss="alert"
    aria-label="Close"
  >
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<div class="info-text">
  <p>
    <b>Posts that needs to be approved!</b>
  </p>

  <!--

  fxLayout="row wrap"
  fxLayout.xs="column"
  fxLayoutWrap
  fxLayoutGap="1.0%"
  fxLayoutAlign="center"
  fxFlexAlign="auto"

  -->
  <div
    fxLayout="row wrap"
    fxLayout.xs="column"
    fxLayoutWrap
    fxLayoutGap="1.0%"
    fxLayoutAlign="center"
    fxFlexAlign="auto"
  >
    <div class="centered" *ngFor="let post of posts">
      <section class="cards" *ngIf="!post.approved">
        <mat-card class="request-post-card">
          <mat-card-title class="post-card-title">{{ post.title }}</mat-card-title>
          <mat-card-subtitle class="post-card-subtitle"
            >{{ post.startDate | date }} to
            {{ post.endDate | date }}</mat-card-subtitle
          >
          <mat-card-content class="post-card-content">{{ post.content }}</mat-card-content>
          <mat-card-footer class="post-card-footer">
            <button
              class="btn btn-outline-primary mb-2 mr-2"
              (click)="onPublish(post.id, publishContent)"
            >
              Publish
            </button>

            <button
              class="btn btn-outline-primary mb-2 mr-2"
              (click)="onMoreInfo(content)"
            >
              Learn More
            </button>

            <button
              class="btn btn-outline-primary mb-2 mr-2"
              (click)="onDeletePrompt(deleteUnapprovedContent)"
            >
              Delete
            </button>
          </mat-card-footer>
        </mat-card>
      </section>

      <ng-template #content let-modal>
        <div class="modal-header">
          <h4 class="modal-title">{{ post.title }}</h4>
          <button
            type="button"
            class="close"
            aria-label="Close"
            (click)="modal.dismiss('Cross click')"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <p>Organization Name: {{ post.orgName }}</p>
          <p>UEN: {{ post.uen }}</p>
          <p>Point of Contact (POC): {{ post.POC }}</p>
          <p>POC's phoneNumber: {{ post.phoneNumber }}</p>
          <p>POC's email: {{ post.email }}</p>
          <p>Brief Description for gig: {{ post.content }}</p>
          <p>Frequency/Type of volunteer opportunity: {{ post.opportunity }}</p>
          <p>Preferred Skills: {{ post.skills }}</p>
          <p>Start Date: {{ post.startDate | date }}</p>
          <p>End Date: {{ post.endDate | date }}</p>
          <p>Commitment Hours: {{ post.hoursRequired }}</p>
          <p>Beneficiaries: {{ post.beneficiaries }}</p>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-light"
            (click)="modal.close('Close click')"
          >
            Close
          </button>
        </div>
      </ng-template>

      <ng-template #deleteUnapprovedContent let-modal>
        <div class="modal-header">
          <h4 class="modal-title">Delete Confirmation</h4>
          <button
            type="button"
            class="submit"
            aria-label="apply"
            (click)="modal.dismiss('Cross click')"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <p>Are you sure you want to delete the post?</p>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-light"
            (click)="onDelete(post.id) && modal.dismiss('Cross click')"
          >
            Confirm Delete
          </button>

          <button
            type="button"
            class="btn btn-light"
            (click)="modal.dismiss('Cross click')"
          >
            Cancel
          </button>
        </div>
      </ng-template>
    </div>
  </div>

  <p class="info-text mat-body-1" *ngIf="hasRequest === false">No post request!</p>
  <mat-spinner *ngIf="hasRequest === null" class="spinner"></mat-spinner>

</div>

<div class="info-text">
  <p>
    <b>Posts with reports! :O</b>
  </p>

  <!--
    <div
  fxLayout="row wrap"
  fxLayout.xs="column"
  fxLayoutWrap
  fxLayoutAlign="center"
  fxFlexAlign="auto"
  >
  -->
  <div
    fxLayout="row wrap"
    fxLayout.xs="column"
    fxLayoutWrap
    fxLayoutGap="1.0%"
    fxLayoutAlign="center"
    fxFlexAlign="auto"
  >
    <div class="centered" *ngFor="let post of posts">
      <section class="cards" *ngIf="post.reports.length > 0">
        <mat-card class="report-post-card">
          <mat-card-title class="post-card-title">{{ post.title }}</mat-card-title>
          <mat-card-subtitle class="post-card-subtitle"
            >{{ post.startDate | date }} to
            {{ post.endDate | date }}</mat-card-subtitle
          >
          <mat-card-content class="post-card-content">{{ post.content }}</mat-card-content>
          <mat-footer class="post-card-footer">
            <button
              class="btn btn-outline-primary mb-2 mr-2"
              (click)="onMoreInfo(reportContent)"
            >
              Read Report
            </button>

            <button
              class="btn btn-outline-primary mb-2 mr-2"
              (click)="onMoreInfo(content)"
            >
              Learn More
            </button>

            <button
              class="btn btn-outline-primary mb-2 mr-2"
              (click)="onDeletePrompt(deleteReportedContent)"
            >
              Delete
            </button>
          </mat-footer>
        </mat-card>
        <!--
        <p-card
          class="card"
          [style]="{
            width: '25rem',
            height: '15rem',
            'text-align': 'center',
            'background-color': '#2e1215',
            color: 'white'
          }"
          styleClass="p-card-shadow"
        >
          <p-card-header
            [style]="{
              'text-overflow': 'ellipsis',
              width: '22rem',
              'max-width': '22rem',
              height: '1.7rem',
              display: 'block',
              overflow: 'hidden',
              'white-space': 'nowrap',
              color: 'white',
              'font-size': '1.5rem'
            }"
          >
            <b>{{ post.title }}</b>
          </p-card-header>

          <p-card-subheader
            [style]="{
              height: '3.5rem',
              display: 'block',
              overflow: 'hidden',
              'white-space': 'nowrap',
              color: '#D9D9D9'
            }"
          >
            {{ post.startDate | date }} to {{ post.endDate | date }}
          </p-card-subheader>

          <p-card-content
            [style]="{
              'text-overflow': 'ellipsis',
              width: '22rem',
              'max-width': '22rem',
              height: '3rem',
              display: 'block',
              overflow: 'hidden',
              'white-space': 'nowrap',
              color: '#D9D9D9'
            }"
            >{{ post.content }}
          </p-card-content>

          <ng-template pTemplate="footer" #footer>
            <button
              class="btn btn-outline-primary mb-2 mr-2"
              (click)="onMoreInfo(reportContent)"
            >
              Read Report
            </button>

            <button
              class="btn btn-outline-primary mb-2 mr-2"
              (click)="onMoreInfo(content)"
            >
              Learn More
            </button>

            <button
              class="btn btn-outline-primary mb-2 mr-2"
              (click)="onDeletePrompt(deleteReportedContent)"
            >
              Delete
            </button>
          </ng-template>
        </p-card>
      -->
    </section>

      <ng-template #reportContent let-modal>
        <div class="modal-header">
          <h4 class="modal-title">{{ post.title }}</h4>
          <button
            type="button"
            class="close"
            aria-label="Close"
            (click)="modal.dismiss('Cross click')"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <div *ngFor="let report of post.reports" class="modal-body-report">
            <div>
              <p>Student's Email: {{ report.email }}</p>
              <p>Student's Contact: {{ report.contact }}</p>
              <p>Student's Report: {{ report.content }}</p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-light"
            (click)="modal.close('Close click')"
          >
            Close
          </button>
        </div>
      </ng-template>

      <ng-template #content let-modal>
        <div class="modal-header">
          <h4 class="modal-title">{{ post.title }}</h4>
          <button
            type="button"
            class="close"
            aria-label="Close"
            (click)="modal.dismiss('Cross click')"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <p>Organization Name: {{ post.orgName }}</p>
          <p>UEN: {{ post.uen }}</p>
          <p>Point of Contact (POC): {{ post.POC }}</p>
          <p>POC's phoneNumber: {{ post.phoneNumber }}</p>
          <p>POC's email: {{ post.email }}</p>
          <p>Brief Description for gig: {{ post.content }}</p>
          <p>Preferred Skills: {{ post.skills }}</p>
          <p>Start Date: {{ post.startDate | date }}</p>
          <p>End Date: {{ post.endDate | date }}</p>
          <p>Commitment Hours: {{ post.hoursRequired }}</p>
          <p>Beneficiaries: {{ post.beneficiaries }}</p>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-light"
            (click)="modal.close('Close click')"
          >
            Close
          </button>
        </div>
      </ng-template>

      <ng-template #deleteReportedContent let-modal>
        <div class="modal-header">
          <h4 class="modal-title">Delete Confirmation</h4>
          <button
            type="button"
            class="submit"
            aria-label="apply"
            (click)="modal.dismiss('Cross click')"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <p>Are you sure you want to delete the post?</p>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-light"
            (click)="
              onDeleteReportedPost(post.id) && modal.dismiss('Cross click')
            "
          >
            Confirm Delete
          </button>

          <button
            type="button"
            class="btn btn-light"
            (click)="modal.dismiss('Cross click')"
          >
            Cancel
          </button>
        </div>
      </ng-template>
    </div>
  </div>

  <p class="info-text mat-body-1" *ngIf="hasReport === false">
    No post with reports! :D
  </p>
  <mat-spinner *ngIf="hasReport === null"></mat-spinner>
</div>

<footer class="container">
  <!--
  <p class="float-end"><a href="#">Back to top</a></p>
  -->
  <p class="copyright">&copy; Orbital 2021 Team StudyGoWhere, ID 2601, Darren Hoon and Wilbur Fong. <br>
    In conjuction with the Centre for Computing for Social Good and Philanthropy (CCSGP), NUS.
    <!--
    <a href="#">Privacy</a> &middot; <a href="#">Terms</a>
    -->
  </p>
</footer>

<ng-template #publishContent let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Publish Success</h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>Post Published Successfully!</p>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-light"
      (click)="modal.close('Close click')"
    >
      Back
    </button>
  </div>
</ng-template>

<ng-template #studentsReport let-modal>
  <div class="modal-header">
    <h4 class="modal-title">{{ post.title }}</h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div *ngFor="let report of post.reports">
      <p>Email: {{ report.email }}</p>
      <p>Contact Number: {{ report.contact }}</p>
      <p>Reason for Reporting: {{ report.content }}</p>
    </div>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-light"
      (click)="modal.close('Close click')"
    >
      Close
    </button>
  </div>
</ng-template>
